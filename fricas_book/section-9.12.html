<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Section9.12</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Section9.12</h1>
</header>
]&gt;
<a href="book-contents.xhtml">Book Contents</a><a href="section-9.11.xhtml">Previous Section 9.11 Complex</a><a href="section-9.13.xhtml">Next Section 9.13 CycleIndicators</a><a href="book-index.xhtml">Book Index</a>
<section id="sec-9.12">
<h2 class="sectiontitle" id="continuedfraction">9.12 ContinuedFraction</h2>
<span id="ContinuedFractionXmpPage" class="label"></span>
<p>Continued fractions have been a fascinating and useful tool in mathematics for well over three hundred years. FriCAS implements continued fractions for fractions of any Euclidean domain. In practice, this usually means rational numbers. In this section we demonstrate some of the operations available for manipulating both finite and infinite continued fractions. It may be helpful if you review <a href="section-9.76.xhtml#StreamXmpPage" class="ref">StreamXmpPage</a> to remind yourself of some of the operations with streams.</p>
<p>The <span class="teletype">ContinuedFraction</span> domain is a field and therefore you can add, subtract, multiply and divide the fractions.</p>
<p>The <span class="spadfunFrom">continuedFraction</span><span class="index">continuedFraction</span><span id="chapter-9-65"></span><span class="index">ContinuedFraction</span><span id="chapter-9-66"></span> operation converts its fractional argument to a continued fraction.</p>
<div id="spadComm9-206" class="spadComm">
<span id="commSav9-206" class="commSav">c := continuedFraction(314159/100000) </span>
<div id="mathAns9-206">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>3+1||7+1||15+1||1+1||25+1||1+1||7+1||4</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: ContinuedFraction Integer
</div>
<p>This display is a compact form of the bulkier</p>
<div class="verbatim">
<br />
        3 +                 1<br />
            -------------------------------<br />
            7 +               1<br />
                ---------------------------<br />
                15 +            1<br />
                     ----------------------<br />
                     1 +          1<br />
                         ------------------<br />
                         25 +       1<br />
                              -------------<br />
                              1 +     1<br />
                                  ---------<br />
                                  7 +   1<br />
                                      -----<br />
                                        4<br />

</div>
<p>You can write any rational number in a similar form. The fraction will be finite and you can always take the <span class="italic">numerators</span> to be <span class="teletype">1</span>. That is, any rational number can be written as a simple, finite continued fraction of the form</p>
<div class="verbatim">
<br />
        a(1) +           1<br />
               -------------------------<br />
               a(2) +          1<br />
                      --------------------<br />
                      a(3) +<br />
                             .<br />
                              .<br />
                               .<br />
                                     1<br />
                               -------------<br />
                               a(n-1) +  1<br />
                                        ----<br />
                                        a(n)<br />

</div>
The
ai are called partial quotients and the operation <span class="spadfunFrom">partialQuotients</span><span class="index">partialQuotients</span><span id="chapter-9-67"></span><span class="index">ContinuedFraction</span><span id="chapter-9-68"></span> creates a stream of them.
<div id="spadComm9-207" class="spadComm">
<span id="commSav9-207" class="commSav">partialQuotients c </span>
<div id="mathAns9-207">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[3,7,15,1,25,1,7,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Integer
</div>
By considering more and more of the fraction, you get the <span class="spadfunFrom">convergents</span><span class="index">convergents</span><span id="chapter-9-69"></span><span class="index">ContinuedFraction</span><span id="chapter-9-70"></span>. For example, the first convergent is
a1, the second is
a1+1/a2 and so on.
<div id="spadComm9-208" class="spadComm">
<span id="commSav9-208" class="commSav">convergents c </span>
<div id="mathAns9-208">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[3,227,333106,355113,92082931,95633044,7614924239,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Fraction Integer
</div>
<p>Since this is a finite continued fraction, the last convergent is the original rational number, in reduced form. The result of <span class="spadfunFrom">approximants</span><span class="index">approximants</span><span id="chapter-9-71"></span><span class="index">ContinuedFraction</span><span id="chapter-9-72"></span> is always an infinite stream, though it may just repeat the <span class="italic">last</span> value.</p>
<div id="spadComm9-209" class="spadComm">
<span id="commSav9-209" class="commSav">approximants c </span>
<div id="mathAns9-209">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[3,227,333106,355113,92082931,95633044,7614924239,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Fraction Integer
</div>
<p>Inverting <span class="teletype">c</span> only changes the partial quotients of its fraction by inserting a <span class="teletype">0</span> at the beginning of the list.</p>
<div id="spadComm9-210" class="spadComm">
<span id="commSav9-210" class="commSav">pq := partialQuotients(1/c) </span>
<div id="mathAns9-210">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[0,3,7,15,1,25,1,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Integer
</div>
<p>Do this to recover the original continued fraction from this list of partial quotients. The three-argument form of the <span class="spadfunFrom">continuedFraction</span><span class="index">continuedFraction</span><span id="chapter-9-73"></span><span class="index">ContinuedFraction</span><span id="chapter-9-74"></span> operation takes an element which is the whole part of the fraction, a stream of elements which are the numerators of the fraction, and a stream of elements which are the denominators of the fraction.</p>
<div id="spadComm9-211" class="spadComm">
<span id="commSav9-211" class="commSav">continuedFraction(first pq,repeating [1],rest pq) </span>
<div id="mathAns9-211">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>1||3+1||7+1||15+1||1+1||25+1||1+1||7</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: ContinuedFraction Integer
</div>
<p>The streams need not be finite for <span class="spadfunFrom">continuedFraction</span><span class="index">continuedFraction</span><span id="chapter-9-75"></span><span class="index">ContinuedFraction</span><span id="chapter-9-76"></span>. Can you guess which irrational number has the following continued fraction? See the end of this section for the answer.</p>
<div id="spadComm9-212" class="spadComm">
<span id="commSav9-212" class="commSav">z:=continuedFraction(3,repeating [1],repeating [3,6]) </span>
<div id="mathAns9-212">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>3+1||3+1||6+1||3+1||6+1||3+1||6+1||3</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: ContinuedFraction Integer
</div>
<p>In 1737 Euler discovered the infinite continued fraction expansion</p>
<div class="verbatim">
<br />
        e - 1             1<br />
        ----- = ---------------------<br />
          2     1 +         1<br />
                    -----------------<br />
                    6 +       1<br />
                        -------------<br />
                        10 +    1<br />
                             --------<br />
                             14 + ...<br />

</div>
<p>We use this expansion to compute rational and floating point approximations of <span class="teletype">e</span>. <span class="footnote">For this and other interesting expansions, see C. D. Olds, <span class="italic">Continued Fractions,</span> New Mathematical Library, (New York: Random House, 1963), pp. 134--139.</span></p>
<p>By looking at the above expansion, we see that the whole part is <span class="teletype">0</span> and the numerators are all equal to <span class="teletype">1</span>. This constructs the stream of denominators.</p>
<div id="spadComm9-213" class="spadComm">
<span id="commSav9-213" class="commSav">dens:Stream Integer := cons(1,generate((x+-&gt;x+4),6)) </span>
<div id="mathAns9-213">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[1,6,10,14,18,22,26,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Integer
</div>
Therefore this is the continued fraction expansion for
(e-1)/2.
<div id="spadComm9-214" class="spadComm">
<span id="commSav9-214" class="commSav">cf := continuedFraction(0,repeating [1],dens) </span>
<div id="mathAns9-214">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>1||1+1||6+1||10+1||14+1||18+1||22+1||26</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: ContinuedFraction Integer
</div>
<p>These are the rational number convergents.</p>
<div id="spadComm9-215" class="spadComm">
<span id="commSav9-215" class="commSav">ccf := convergents cf </span>
<div id="mathAns9-215">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[0,1,67,6171,8601001,1554118089,342762398959,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Fraction Integer
</div>
<p>You can get rational convergents for <span class="teletype">e</span> by multiplying by <span class="teletype">2</span> and adding <span class="teletype">1</span>.</p>
<div id="spadComm9-216" class="spadComm">
<span id="commSav9-216" class="commSav">eConvergents := [2*e + 1 for e in ccf] </span>
<div id="mathAns9-216">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[1,3,197,19371,27211001,4917118089,1084483398959,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Fraction Integer
</div>
<p>You can also compute the floating point approximations to these convergents.</p>
<div id="spadComm9-217" class="spadComm">
<span id="commSav9-217" class="commSav">eConvergents :: Stream Float </span>
<div id="mathAns9-217">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[1.0,3.0,2.7142857142857142857,2.7183098591549295775,2.7182817182817182817,2.7182818287356957267,2.7182818284585634113,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Float
</div>
<p>Compare this to the value of <span class="teletype">e</span> computed by the <span class="spadfunFrom">exp</span><span class="index">exp</span><span id="chapter-9-77"></span><span class="index">Float</span><span id="chapter-9-78"></span> operation in <span class="teletype">Float</span>.</p>
<div id="spadComm9-218" class="spadComm">
<span id="commSav9-218" class="commSav">exp 1.0</span>
<div id="mathAns9-218">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>2.7182818284590452354</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Float
</div>
In about 1658, Lord Brouncker established the following expansion for
4/π,
<div class="verbatim">
<br />
        1 +            1<br />
            -----------------------<br />
            2 +          9<br />
                -------------------<br />
                2 +        25<br />
                    ---------------<br />
                    2 +      49<br />
                        -----------<br />
                        2 +    81<br />
                            -------<br />
                            2 + ...<br />

</div>
Let's use this expansion to compute rational and floating point approximations for
π.
<div id="spadComm9-219" class="spadComm">
<span id="commSav9-219" class="commSav">cf := continuedFraction(1,[(2*i+1)^2 for i in 0..],repeating [2])</span>
<div id="mathAns9-219">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>1+1||2+9||2+25||2+49||2+81||2+121||2+169||2</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: ContinuedFraction Integer
</div>
<div id="spadComm9-220" class="spadComm">
<span id="commSav9-220" class="commSav">ccf := convergents cf </span>
<div id="mathAns9-220">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[1,32,1513,10576,315263,34652578,4504536979,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Fraction Integer
</div>
<div id="spadComm9-221" class="spadComm">
<span id="commSav9-221" class="commSav">piConvergents := [4/p for p in ccf] </span>
<div id="mathAns9-221">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[4,83,5215,304105,1052315,103123465,14791645045,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Fraction Integer
</div>
As you can see, the values are converging to
π=3.14159265358979323846..., but not very quickly.
<div id="spadComm9-222" class="spadComm">
<span id="commSav9-222" class="commSav">piConvergents :: Stream Float </span>
<div id="mathAns9-222">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[4.0,2.6666666666666666667,3.4666666666666666667,2.8952380952380952381,3.3396825396825396825,2.9760461760461760462,3.2837384837384837385,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Float
</div>
<p>You need not restrict yourself to continued fractions of integers. Here is an expansion for a quotient of Gaussian integers.</p>
<div id="spadComm9-223" class="spadComm">
<span id="commSav9-223" class="commSav">continuedFraction((- 122 + 597*%i)/(4 - 4*%i))</span>
<div id="mathAns9-223">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>-90+59i+1||1-2i+1||-1+2i</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: ContinuedFraction Complex Integer
</div>
<p>This is an expansion for a quotient of polynomials in one variable with rational number coefficients.</p>
<div id="spadComm9-224" class="spadComm">
<span id="commSav9-224" class="commSav">r : Fraction UnivariatePolynomial(x,Fraction Integer) </span>
<div id="mathAns9-224">

</div>
</div>
<div class="returnType">
Type: Void
</div>
<div id="spadComm9-225" class="spadComm">
<span id="commSav9-225" class="commSav">r := ((x - 1) * (x - 2)) / ((x-3) * (x-4)) </span>
<div id="mathAns9-225">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>x2-3x+2x2-7x+12</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Fraction UnivariatePolynomial(x,Fraction Integer)
</div>
<div id="spadComm9-226" class="spadComm">
<span id="commSav9-226" class="commSav">continuedFraction r </span>
<div id="mathAns9-226">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>1+1||14x-98+1||163x-403</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: ContinuedFraction UnivariatePolynomial(x,Fraction Integer)
</div>
<p>To conclude this section, we give you evidence that</p>
<div class="verbatim">
<br />
    z = 3 +            1<br />
            -----------------------<br />
            3 +          1<br />
                -------------------<br />
                6 +        1<br />
                    ---------------<br />
                    3 +      1<br />
                        -----------<br />
                        6 +    1<br />
                            -------<br />
                            3 + ...<br />

</div>
is the expansion of
11.
<div id="spadComm9-227" class="spadComm">
<span id="commSav9-227" class="commSav">[i*i for i in convergents(z) :: Stream Float] </span>
<div id="mathAns9-227">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[9.0,11.111111111111111111,10.99445983379501385,11.000277777777777778,10.999986076398799786,11.000000697929731039,10.999999965015834446,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Float
</div>
</section>
<a href="book-contents.xhtml">Book Contents</a> <a href="section-9.11.xhtml">Previous Section 9.11 Complex</a><a href="section-9.13.xhtml">Next Section 9.13 CycleIndicators</a><a href="book-index.xhtml">Book Index</a>
</body>
</html>
