<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Section6.11</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Section6.11</h1>
</header>
]&gt;
<a href="book-contents.xhtml">Book Contents</a><a href="section-6.10.xhtml">Previous Section 6.10 Compiling vs. Interpreting</a><a href="section-6.12.xhtml">Next Section 6.12 Caching Previously Computed Results</a> <a href="book-index.xhtml">Book Index</a>
<section id="sec-6.11">
<h2 class="sectiontitle" id="piece-wise-function-definitions">6.11 Piece-Wise Function Definitions</h2>
<span id="ugUserPiece" class="label"></span>
<p>To move beyond functions defined in one line, we introduce in this section functions that are defined piece-by-piece. That is, we say <span class="italic">use this definition when the argument is such-and-such and use this other definition when the argument is that-and-that.</span></p>
<span id="subsec-6.11.1"></span>
<div id="subsec-6.11.1" class="subsection">
<h3 class="subsectitle" id="a-basic-example">6.11.1 A Basic Example</h3>
<span id="ugUserPieceBasic" class="label"></span>
There are many other ways to define a factorial function for nonnegative integers. You might <span class="index">function:piece-wise definition</span><span id="chapter-6-23"></span> say <span class="index">piece-wise function definition</span><span id="chapter-6-24"></span> factorial of
0 is
1, otherwise factorial of
n is
n times factorial of
n-1. Here is one way to do this in FriCAS.
Here is the value for
n=0.
<div id="spadComm6-58" class="spadComm">
<span id="commSav6-58" class="commSav">fact(0) == 1</span>
<div id="mathAns6-58">

</div>
</div>
<div class="returnType">
Type: Void
</div>
Here is the value for
n&gt;0. The vertical bar ``<span class="teletype">|</span>'' means <span class="italic">such that</span>. <span class="index">such that</span><span id="chapter-6-25"></span>
<div id="spadComm6-59" class="spadComm">
<span id="commSav6-59" class="commSav">fact(n | n &gt; 0) == n * fact(n - 1)</span>
<div id="mathAns6-59">

</div>
</div>
<div class="returnType">
Type: Void
</div>
What is the value for
n=3?
<div id="spadComm6-60" class="spadComm">
<span id="commSav6-60" class="commSav">fact(3)</span>
<div id="mathAns6-60">

</div>
</div>
<div class="verbatim">
<br />
   Compiling function fact with type Integer -&gt; Integer <br />
   Compiling function fact as a recurrence relation.<br />

</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>6</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: PositiveInteger
</div>
What is the value for
n=-3?
<div id="spadComm6-61" class="spadComm">
<span id="commSav6-61" class="commSav">fact(-3)</span>
<div id="mathAns6-61">

</div>
</div>
<div class="verbatim">
<br />
   You did not define fact for argument -3 .<br />

</div>
Now for a second definition. Here is the value for
n=0.
<div id="spadComm6-62" class="spadComm">
<span id="commSav6-62" class="commSav">facto(0) == 1</span>
<div id="mathAns6-62">

</div>
</div>
<div class="returnType">
Type: Void
</div>
Give an error message if
n&lt;0.
<div id="spadComm6-63" class="spadComm">
<span id="commSav6-63" class="commSav">facto(n | n &lt; 0) == error "arguments to facto must be non-negative"</span>
<div id="mathAns6-63">

</div>
</div>
<div class="returnType">
Type: Void
</div>
<p>Here is the value otherwise.</p>
<div id="spadComm6-64" class="spadComm">
<span id="commSav6-64" class="commSav">facto(n) == n * facto(n - 1)</span>
<div id="mathAns6-64">

</div>
</div>
<div class="returnType">
Type: Void
</div>
What is the value for
n=7?
<div id="spadComm6-65" class="spadComm">
<span id="commSav6-65" class="commSav">facto(3)</span>
<div id="mathAns6-65">

</div>
</div>
<div class="verbatim">
<br />
   Compiling function facto with type Integer -&gt; Integer <br />

</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>6</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: PositiveInteger
</div>
What is the value for
n=-7?
<div id="spadComm6-66" class="spadComm">
<span id="commSav6-66" class="commSav">facto(-7)</span>
<div id="mathAns6-66">

</div>
</div>
<div class="verbatim">
<br />
   Error signalled from user code in function facto: <br />
      arguments to facto must be non-negative<br />

</div>
<div class="returnType">
Type: PositiveInteger
</div>
<p>To see the current piece-wise definition of a function, use <span class="teletype">)display value</span>.</p>
<div id="spadComm6-67" class="spadComm">
<span id="commSav6-67" class="commSav">)display value facto</span>
<div id="mathAns6-67">

</div>
</div>
<div class="verbatim">
<br />
   Definition:<br />
     facto 0 == 1<br />
     facto (n | n &lt; 0) == <br />
       error(arguments to facto must be non-negative)<br />
     facto n == n facto(n - 1)<br />

</div>
<p>In general a <span class="italic">piece-wise definition</span> of a function consists of two or more parts. Each part gives a <span class="italic">piece</span> of the entire definition. FriCAS collects the pieces of a function as you enter them. When you ask for a value of the function, it then <span class="italic">glues</span> the pieces together to form a function.</p>
The two piece-wise definitions for the factorial function are examples of recursive functions, that is, functions that are defined in terms of themselves. Here is an interesting doubly-recursive function. This function returns the value
11 for all positive integer arguments.
<p>Here is the first of two pieces.</p>
<div id="spadComm6-68" class="spadComm">
<span id="commSav6-68" class="commSav">eleven(n | n &lt; 1) == n + 11</span>
<div id="mathAns6-68">

</div>
</div>
<div class="returnType">
Type: Void
</div>
<p>And the general case.</p>
<div id="spadComm6-69" class="spadComm">
<span id="commSav6-69" class="commSav">eleven(m) == eleven(eleven(m - 12))</span>
<div id="mathAns6-69">

</div>
</div>
<div class="returnType">
Type: Void
</div>
Compute
elevens, the infinite stream of values of
eleven.
<div id="spadComm6-70" class="spadComm">
<span id="commSav6-70" class="commSav">elevens := [eleven(i) for i in 0..]</span>
<div id="mathAns6-70">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[11,11,11,11,11,11,11,11,11,11,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Integer
</div>
What is the value at
n=200?
<div id="spadComm6-71" class="spadComm">
<span id="commSav6-71" class="commSav">elevens 200</span>
<div id="mathAns6-71">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>11</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: PositiveInteger
</div>
What is the FriCAS's definition of
eleven?
<div id="spadComm6-72" class="spadComm">
<span id="commSav6-72" class="commSav">)display value eleven</span>
<div id="mathAns6-72">

</div>
</div>
<div class="verbatim">
<br />
   Definition:<br />
     eleven (m | m &lt; 1) == m + 11<br />
     eleven m == eleven(eleven(m - 12))<br />

</div>
</div>
<span id="subsec-6.11.2"></span>
<div id="subsec-6.11.2" class="subsection">
<h3 class="subsectitle" id="picking-up-the-pieces">6.11.2 Picking Up the Pieces</h3>
<span id="ugUserPiecePicking" class="label"></span>
Here are the details about how FriCAS creates a function from its pieces. FriCAS converts the
i-th piece of a function definition into a conditional expression of the form: <span class="teletype">if</span>
predi <span class="teletype">then</span>
expressioni. If any new piece has a
predi that is identical (after all variables are uniformly named) to an earlier
predj, the earlier piece is removed. Otherwise, the new piece is always added at the end.
<div class="boxed2">
<div class="boxed">
If there are
n pieces to a function definition for
f, the function defined
f is:<br />

<span class="teletype">if</span>
pred1 <span class="teletype">then</span>
expression1 <span class="teletype">else</span><br />
<span class="hspace600pc">. . . </span><br />

<span class="teletype">if</span>
predn <span class="teletype">then</span>
expressionn <span class="teletype">else</span><br />
<span class="hspace300pc"> <span class="teletype"> error "You did not define f for argument &lt;arg&gt;."</span></span><br />

</div>
</div>
<p>You can give definitions of any number of mutually recursive function definitions, piece-wise or otherwise. No computation is done until you ask for a value. When you do ask for a value, all the relevant definitions are gathered, analyzed, and translated into separate functions and compiled.</p>
<p>Let's recall the definition of <span style="font-weight: bold;"> eleven</span> from the previous section.</p>
<div id="spadComm6-73" class="spadComm">
<span id="commSav6-73" class="commSav">eleven(n | n &lt; 1) == n + 11</span>
<div id="mathAns6-73">

</div>
</div>
<div class="returnType">
Type: Void
</div>
<div id="spadComm6-74" class="spadComm">
<span id="commSav6-74" class="commSav">eleven(m) == eleven(eleven(m - 12))</span>
<div id="mathAns6-74">

</div>
</div>
<div class="returnType">
Type: Void
</div>
A similar doubly-recursive function below produces
-11 for all negative positive integers. If you haven't worked out why or how <span style="font-weight: bold;"> eleven</span> works, the structure of this definition gives a clue.
<p>This definition we write as a block.</p>
<div class="verbatim">
<br />
minusEleven(n) ==<br />
  n &gt;= 0 =&gt; n - 11<br />
  minusEleven (5 + minusEleven(n + 7))<br />

</div>
<div class="returnType">
Type: Void
</div>
Define
s(n) to be the sum of plus and minus <span class="italic">eleven</span> functions divided by
n. Since
11-11=0, we define
s(0) to be
1.
<div id="spadComm6-75" class="spadComm">
<span id="commSav6-75" class="commSav">s(0) == 1</span>
<div id="mathAns6-75">

</div>
</div>
<div class="returnType">
Type: Void
</div>
<p>And the general term.</p>
<div id="spadComm6-76" class="spadComm">
<span id="commSav6-76" class="commSav">s(n) == (eleven(n) + minusEleven(n))/n</span>
<div id="mathAns6-76">

</div>
</div>
<div class="returnType">
Type: Void
</div>
What are the first ten values of
s?
<div id="spadComm6-77" class="spadComm">
<span id="commSav6-77" class="commSav">[s(n) for n in 0..]</span>
<div id="mathAns6-77">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[1,1,1,1,1,1,1,1,1,1,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Fraction Integer
</div>
FriCAS can create infinite streams in the positive direction (for example, for index values
0,1,…) or negative direction (for example, for
0,-1,-2,…). Here we would like a stream of values of
s(n) that is infinite in both directions. The function
t(n) below returns the
n-th term of the infinite stream
[s(0),s(1),s(-1),s(2),s(-2),…] Its definition has three pieces.
<p>Define the initial term.</p>
<div id="spadComm6-78" class="spadComm">
<span id="commSav6-78" class="commSav">t(1) == s(0)</span>
<div id="mathAns6-78">

</div>
</div>
<div class="returnType">
Type: Void
</div>
The even numbered terms are the
s(i) for positive
i. We use <span class="italic"><span class="teletype">quo</span></span> rather than <span class="italic"><span class="teletype">/</span></span> since we want the result to be an integer.
<div id="spadComm6-79" class="spadComm">
<span id="commSav6-79" class="commSav">t(n | even?(n)) == s(n quo 2)</span>
<div id="mathAns6-79">

</div>
</div>
<div class="returnType">
Type: Void
</div>
Finally, the odd numbered terms are the
s(i) for negative
i. In piece-wise definitions, you can use different variables to define different pieces. FriCAS will not get confused.
<div id="spadComm6-80" class="spadComm">
<span id="commSav6-80" class="commSav">t(p) == s(- p quo 2)</span>
<div id="mathAns6-80">

</div>
</div>
<div class="returnType">
Type: Void
</div>
Look at the definition of
t. In the first piece, the variable
n was used; in the second piece,
p. FriCAS always uses your last variable to display your definitions back to you.
<div id="spadComm6-81" class="spadComm">
<span id="commSav6-81" class="commSav">)display value t</span>
<div id="mathAns6-81">

</div>
</div>
<div class="verbatim">
<br />
   Definition:<br />
     t 1 == s(0)<br />
     t (p | even?(p)) == s(p quo 2)<br />
     t p == s(- p quo 2)<br />

</div>
Create a series of values of
s applied to alternating positive and negative arguments.
<div id="spadComm6-82" class="spadComm">
<span id="commSav6-82" class="commSav">[t(i) for i in 1..]</span>
<div id="mathAns6-82">

</div>
</div>
<div class="verbatim">
<br />
   Compiling function s with type Integer -&gt; Fraction Integer <br />
   Compiling function t with type PositiveInteger -&gt; Fraction Integer <br />

</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[1,1,1,1,1,1,1,1,1,1,…]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Stream Fraction Integer
</div>
Evidently
t(n)=1 for all
i. Check it at
n=100.
<div id="spadComm6-83" class="spadComm">
<span id="commSav6-83" class="commSav">t(100)</span>
<div id="mathAns6-83">

</div>
</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: Fraction Integer
</div>
</div>
<span id="subsec-6.11.3"></span>
<div id="subsec-6.11.3" class="subsection">
<h3 class="subsectitle" id="predicates">6.11.3 Predicates</h3>
<span id="ugUserPiecePred" class="label"></span>
<p>We have already seen some examples of <span class="index">function:predicate</span><span id="chapter-6-26"></span> predicates <span class="index">predicate:in function definition</span><span id="chapter-6-27"></span> (<a href="section-6.11.xhtml#ugUserPieceBasic" class="ref">ugUserPieceBasic</a> ). Predicates are <span class="teletype">Boolean</span>-valued expressions and FriCAS uses them for filtering collections (see <a href="section-5.5.xhtml#ugLangIts" class="ref">ugLangIts</a> ) and for placing constraints on function arguments. In this section we discuss their latter usage.</p>
<p>The simplest use of a predicate is one you don't see at all.</p>
<div id="spadComm6-84" class="spadComm">
<span id="commSav6-84" class="commSav">opposite 'right == 'left</span>
<div id="mathAns6-84">

</div>
</div>
<div class="returnType">
Type: Void
</div>
<p>Here is a longer way to give the <span class="italic">opposite definition.</span></p>
<div id="spadComm6-85" class="spadComm">
<span id="commSav6-85" class="commSav">opposite (x | x = 'left) == 'right</span>
<div id="mathAns6-85">

</div>
</div>
<div class="returnType">
Type: Void
</div>
<p>Try it out.</p>
<div id="spadComm6-86" class="spadComm">
<span id="commSav6-86" class="commSav">for x in ['right,'left,'inbetween] repeat output opposite x</span>
<div id="mathAns6-86">

</div>
</div>
<div class="verbatim">
<br />
Compiling function opposite with type <br />
   OrderedVariableList [right, left,inbetween] -&gt; Symbol    <br />
 left<br />
 right<br />
 <br />
The function opposite is not defined for the given argument(s).<br />

</div>
Explicit predicates tell FriCAS that the given function definition piece is to be applied if the predicate evaluates to <span class="teletype">true</span> for the arguments to the function. You can use such <span class="italic">constant</span> arguments for integers, <span class="index">function:constant argument</span><span id="chapter-6-28"></span> strings, and quoted symbols. <span class="index">constant function argument</span><span id="chapter-6-29"></span> The <span class="teletype">Boolean</span> values <span class="teletype">true</span> and <span class="teletype">false</span> can also be used if qualified with ``
@'' or ``
$'' and <span class="teletype">Boolean</span>. The following are all valid function definition fragments using constant arguments.
<div class="verbatim">
<br />
a(1) == ...<br />
b("unramified") == ...<br />
c('untested) == ...<br />
d(true@Boolean) == ...<br />

</div>
<p>If a function has more than one argument, each argument can have its own predicate. However, if a predicate involves two or more arguments, it must be given <span class="italic">after</span> all the arguments mentioned in the predicate have been given. You are always safe to give a single predicate at the end of the argument list.</p>
<p>A function involving predicates on two arguments.</p>
<div id="spadComm6-87" class="spadComm">
<span id="commSav6-87" class="commSav">inFirstHalfQuadrant(x | x &gt; 0,y | y &lt; x) == true</span>
<div id="mathAns6-87">

</div>
</div>
<div class="returnType">
Type: Void
</div>
This is incorrect as it gives a predicate on
y before the argument
y is given.
<div id="spadComm6-88" class="spadComm">
<span id="commSav6-88" class="commSav">inFirstHalfQuadrant(x | x &gt; 0 and y &lt; x,y) == true</span>
<div id="mathAns6-88">

</div>
</div>
<div class="verbatim">
<br />
   1 old definition(s) deleted for function or rule inFirstHalfQuadrant<br />

</div>
<div class="returnType">
Type: Void
</div>
<p>It is always correct to write the predicate at the end.</p>
<div id="spadComm6-89" class="spadComm">
<span id="commSav6-89" class="commSav">inFirstHalfQuadrant(x,y | x &gt; 0 and y &lt; x) == true</span>
<div id="mathAns6-89">

</div>
</div>
<div class="verbatim">
<br />
   1 old definition(s) deleted for function or rule inFirstHalfQuadrant<br />

</div>
<div class="returnType">
Type: Void
</div>
<p>Here is the rest of the definition.</p>
<div id="spadComm6-90" class="spadComm">
<span id="commSav6-90" class="commSav">inFirstHalfQuadrant(x,y) == false</span>
<div id="mathAns6-90">

</div>
</div>
<div class="returnType">
Type: Void
</div>
<p>Try it out.</p>
<div id="spadComm6-91" class="spadComm">
<span id="commSav6-91" class="commSav">[inFirstHalfQuadrant(i,3) for i in 1..5]</span>
<div id="mathAns6-91">

</div>
</div>
<div class="verbatim">
<br />
   Compiling function inFirstHalfQuadrant with type (PositiveInteger,<br />
      PositiveInteger) -&gt; Boolean <br />

</div>
<div class="math">
<table>
<tbody>
<tr class="odd">
<td>[false,false,false,true,true]</td>
</tr>
</tbody>
</table>
</div>
<div class="returnType">
Type: List Boolean
</div>
</div>
</section>
<a href="book-contents.xhtml">Book Contents</a> <a href="section-6.10.xhtml">Previous Section 6.10 Compiling vs. Interpreting</a><a href="section-6.12.xhtml">Next Section 6.12 Caching Previously Computed Results</a> <a href="book-index.xhtml">Book Index</a>
</body>
</html>
